# ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç®‡æ‰€ä¸€è¦§

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ATDã‚·ã‚¹ãƒ†ãƒ å†…ã§ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã‚‹ã™ã¹ã¦ã®ç®‡æ‰€ã‚’è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿æå¤±ã‚’é˜²ããŸã‚ã€å„ä¿å­˜ç®‡æ‰€ã§ `db.session.commit()` ãŒæ­£ã—ãå‘¼ã°ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£

### 1. æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `auth.py`
- **é–¢æ•°**: `register()`
- **è¡Œç•ªå·**: 54-55
- **å‡¦ç†**:
  ```python
  db.session.add(new_user)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 2. ç®¡ç†è€…ãƒ•ãƒ©ã‚°ã®åˆ‡ã‚Šæ›¿ãˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `toggle_admin()`
- **è¡Œç•ªå·**: 1067-1068
- **å‡¦ç†**:
  ```python
  user.is_admin = is_admin
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

## âœ… ãƒãƒ¼ãƒ é–¢é€£

### 3. ãƒãƒ¼ãƒ ä½œæˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `create_team()`
- **è¡Œç•ªå·**: 167-178
- **å‡¦ç†**:
  ```python
  db.session.add(new_team)
  db.session.flush()
  db.session.add(admin_member)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 4. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `add_team_member()`
- **è¡Œç•ªå·**: 233-234
- **å‡¦ç†**:
  ```python
  db.session.add(new_member)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

## âœ… ã‚¿ã‚¹ã‚¯é–¢é€£

### 5. å€‹äººã‚¿ã‚¹ã‚¯ä½œæˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `tasks.py`
- **é–¢æ•°**: `create_task()`
- **è¡Œç•ªå·**: 94-95
- **å‡¦ç†**:
  ```python
  db.session.add(new_task)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 6. å€‹äººã‚¿ã‚¹ã‚¯ç·¨é›†
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `tasks.py`
- **é–¢æ•°**: `update_task()`
- **è¡Œç•ªå·**: 154
- **å‡¦ç†**:
  ```python
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 7. ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯è¿½åŠ 
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `add_team_task_to_node()`
- **è¡Œç•ªå·**: 495-496
- **å‡¦ç†**:
  ```python
  db.session.add(team_task)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 8. ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯å®Œäº†åˆ‡ã‚Šæ›¿ãˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `toggle_team_task()`
- **è¡Œç•ªå·**: 525, 532
- **å‡¦ç†**:
  ```python
  task.completed = not task.completed
  db.session.commit()
  node.progress = node.calculate_progress()
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

## âœ… ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—é–¢é€£

### 9. ãƒãƒ¼ãƒ ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ä½œæˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `create_team_mindmap()`
- **è¡Œç•ªå·**: 577-578
- **å‡¦ç†**:
  ```python
  db.session.add(new_mindmap)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 10. ãƒãƒ¼ãƒ ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ãƒãƒ¼ãƒ‰ä½œæˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `team_mindmap_nodes()`
- **è¡Œç•ªå·**: 654-673
- **å‡¦ç†**:
  ```python
  db.session.add(new_node)
  db.session.flush()
  if parent_id:
      db.session.add(team_task)
      db.session.flush()
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 11. å€‹äººãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ä½œæˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `create_personal_mindmap()`
- **è¡Œç•ªå·**: 836-837
- **å‡¦ç†**:
  ```python
  db.session.add(new_mindmap)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 12. å€‹äººãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ãƒãƒ¼ãƒ‰ä½œæˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `routes.py`
- **é–¢æ•°**: `personal_mindmap_nodes()`
- **è¡Œç•ªå·**: 908-913
- **å‡¦ç†**:
  ```python
  db.session.add(new_task)
  db.session.flush()
  db.session.add(new_node)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

### 13. ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—ãƒãƒ¼ãƒ‰ã®æ›´æ–°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `tasks.py`
- **é–¢æ•°**: `add_to_mindmap()`
- **è¡Œç•ªå·**: 314-315
- **å‡¦ç†**:
  ```python
  db.session.add(new_node)
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

## âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é–¢é€£

### 14. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ›´æ–°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `models.py`
- **é–¢æ•°**: `update_daily_performance()`
- **è¡Œç•ªå·**: 93, 120
- **å‡¦ç†**:
  ```python
  db.session.add(performance)
  performance.streak_days = streak_days
  db.session.commit()
  ```
- **çŠ¶æ…‹**: âœ… æ­£å¸¸

## ğŸ“Š ä¿å­˜å‡¦ç†çµ±è¨ˆ

- **åˆè¨ˆä¿å­˜ç®‡æ‰€**: 14ç®‡æ‰€
- **commit()ä½¿ç”¨ç®‡æ‰€**: 14ç®‡æ‰€ï¼ˆ100%ï¼‰
- **æœªcommitç®‡æ‰€**: 0ç®‡æ‰€

## ğŸ” ç¢ºèªæ–¹æ³•

### 1. æ‰‹å‹•ç¢ºèª
å„ãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã‚’æ¤œç´¢:
```bash
grep -n "db.session.add\|db.session.commit" *.py
```

### 2. è‡ªå‹•ãƒã‚§ãƒƒã‚¯
```bash
# commit()ãªã—ã®add()ã‚’æ¢ã™
grep -A 5 "db.session.add" *.py | grep -v "commit"
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
```bash
sqlite3 instance/atd.db "PRAGMA integrity_check;"
```

## âš ï¸ é‡è¦ãªæ³¨æ„ç‚¹

### çµ¶å¯¾ã«å®ˆã‚‹ã¹ããƒ«ãƒ¼ãƒ«
1. âœ… `db.session.add()` ã®å¾Œã«å¿…ãš `db.session.commit()` ã‚’å‘¼ã¶
2. âœ… `flush()` ã‚’ä½¿ç”¨ã—ãŸå¾Œã‚‚å¿…ãš `commit()` ã‚’å‘¼ã¶
3. âœ… ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ `rollback()` ã‚’å‘¼ã¶

### ã‚ˆãã‚ã‚‹é–“é•ã„
1. âŒ `flush()` ã ã‘ã§æº€è¶³ã—ãªã„ï¼ˆä¸€æ™‚çš„ãªä¿å­˜ã®ã¿ï¼‰
2. âŒ `commit()` ã‚’å¿˜ã‚Œã‚‹ï¼ˆå¤‰æ›´ãŒå¤±ã‚ã‚Œã‚‹ï¼‰
3. âŒ ã‚¨ãƒ©ãƒ¼æ™‚ã« `rollback()` ã‚’å¿˜ã‚Œã‚‹ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒä¸æ•´åˆã«ãªã‚‹ï¼‰

## ğŸ“… å®šæœŸãƒã‚§ãƒƒã‚¯

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç¢ºèªã—ã¦ãã ã•ã„ï¼š
- âœ… æ–°ã—ã„ä¿å­˜å‡¦ç†ã‚’è¿½åŠ ã—ãŸå¾Œ
- âœ… ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸå¾Œ
- âœ… æ¯é€±ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚
- âœ… ãƒ‡ãƒ—ãƒ­ã‚¤å‰

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `auth.py` - èªè¨¼é–¢é€£ã®ä¿å­˜å‡¦ç†
- `routes.py` - ãƒãƒ¼ãƒ ãƒ»ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—é–¢é€£ã®ä¿å­˜å‡¦ç†
- `tasks.py` - ã‚¿ã‚¹ã‚¯é–¢é€£ã®ä¿å­˜å‡¦ç†
- `models.py` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é–¢é€£ã®ä¿å­˜å‡¦ç†
- `instance/atd.db` - SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ2æ—¥
**ç¢ºèªè€…**: Auto AI
**çŠ¶æ…‹**: å…¨ç®‡æ‰€æ­£å¸¸ âœ…

