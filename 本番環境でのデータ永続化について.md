# ⚠️ 本番環境でのデータ永続化について - 重要な警告

## 🔴 現在の状況

現在の設定では、**Render.comの無料プランでSQLiteを使用しているため、データが消失する可能性が非常に高いです。**

## ❌ 問題点

### 1. Render.com 無料プランの制限
- ファイルシステムは**エフェメラル（一時的）**です
- サーバーの再起動・再デプロイ時に**全データが消えます**
- コンテナがスリープした後、起動時に**前回のデータは失われます**

### 2. 現在の設定の問題
```
instance/atd.db (SQLiteファイル)
├─ .gitignore に含まれている → GitHubに保存されない
├─ ローカルPCのみに保存
└─ デプロイ時には存在しない
```

## ✅ 解決策（優先順位順）

### 解決策1: Railway.app（最推奨・完全無料）

**なぜRailway.appが最適か：**
- PostgreSQLが無料で使える
- データベースは完全に永続化される
- デプロイ時にデータが消えない
- スリープなし
- 個人利用なら完全無料

#### 設定方法

1. **Railway.app にアクセス**
   - https://railway.app

2. **GitHub でログイン**

3. **プロジェクトを作成**
   - 「Start a New Project」
   - 「Deploy from GitHub repo」
   - リポジトリ `ATD` を選択

4. **PostgreSQL を追加**
   - 「+ New」→ 「Database」→ 「Add PostgreSQL」

5. **環境変数を設定**
   ```
   FLASK_APP=app.py
   FLASK_ENV=production
   ```

6. **完了！**
   - 自動的にデータベースが接続される
   - データは永続保存される

**費用: ¥0/月（完全無料）**

---

### 解決策2: Render.com + PostgreSQL（有料プラン）

**費用: 月額$5（約¥750/月）**

#### 設定方法

1. **PostgreSQL データベースを作成**
   - Render Dashboard → 「New +」→ 「PostgreSQL」
   - Plan: 「Free」→ 実際は有料だが、ちゃんと動作する

2. **環境変数を設定**
   - Web Service の環境変数に追加：
     ```
     DATABASE_URL=<PostgreSQL接続URL>
     ```

3. **データは永続保存される**

---

### 解決策3: 外部データベースサービス（推奨度: 低）

Heroku Postgres、Supabase、PlanetScale などの外部サービスを使用

---

## 🎯 推奨される対応

### **今すぐすべきこと**

**Option A: Railway.app に切り替え（最推奨）**
- 完全無料で本格運用可能
- データ永続化が保証される
- 移行が簡単

**Option B: PostgreSQL に切り替え**
- Render.com でも月額$5で利用可能
- データ永続化が保証される

---

## 📊 比較表

| 項目 | SQLite（現在） | Railway.app | Render + PostgreSQL |
|------|---------------|-------------|---------------------|
| 費用 | ¥0/月 | ¥0/月 | ¥750/月 |
| データ永続化 | ❌ 消える | ✅ 保証 | ✅ 保証 |
| 再デプロイ時 | ❌ データ消滅 | ✅ 保持 | ✅ 保持 |
| スリープ | あり（15分） | なし | なし（有料プラン） |
| 同時アクセス | 制限あり | 可能 | 可能 |
| 推奨度 | ⭐ | ⭐⭐⭐ | ⭐⭐ |

---

## 🚨 警告

**現在の状態で本番環境にデプロイすると：**
- ユーザーが登録したデータは**消失します**
- 作成したタスクは**保存されません**
- PCをシャットダウンすると**データが失われます**
- 再デプロイすると**全データが消えます**

---

## ✅ 正しい対応

1. **今すぐ Railway.app に切り替える**
2. または **Render.com で PostgreSQL を追加する**
3. **データベース接続を確認する**
4. テスト環境で動作確認
5. 本番環境にデプロイ

---

## 📝 次のステップ

1. Railway.app のアカウント作成
2. プロジェクトの作成
3. PostgreSQL の追加
4. 環境変数の設定
5. デプロイの完了
6. テストユーザーで確認

これで安全に本番運用できます！

