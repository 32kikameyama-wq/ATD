<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÉÅ„Éº„É†„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ - {{ team.name }} - ATD</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="team-mode">
    <div class="app-layout">
        <!-- Â∑¶„Çµ„Ç§„Éâ„Éê„Éº -->
        <aside class="sidebar">
            <div class="sidebar-nav">
                <a href="{{ url_for('main.dashboard') }}" class="sidebar-item">
                    <span class="sidebar-icon">üìä</span>
                    <span>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
                </a>
                <a href="{{ url_for('tasks.list_tasks') }}" class="sidebar-item">
                    <span class="sidebar-icon">üìù</span>
                    <span>„Çø„Çπ„ÇØÁÆ°ÁêÜ</span>
                </a>
                <a href="{{ url_for('main.team_management') }}" class="sidebar-item active">
                    <span class="sidebar-icon">üë•</span>
                    <span>„ÉÅ„Éº„É†ÁÆ°ÁêÜ</span>
                </a>
                <a href="{{ url_for('main.mindmap') }}" class="sidebar-item">
                    <span class="sidebar-icon">üß†</span>
                    <span>„Éû„Ç§„É≥„Éâ„Éû„ÉÉ„Éó</span>
                </a>
                <a href="{{ url_for('main.profile') }}" class="sidebar-item">
                    <span class="sidebar-icon">üë§</span>
                    <span>„Éó„É≠„Éï„Ç£„Éº„É´</span>
                </a>
            </div>
        </aside>

        <div class="main-layout">
            <!-- ‰∏äÈÉ®„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éê„Éº -->
            <nav class="navbar">
                <div class="navbar-content">
                    <div class="navbar-brand">
                        <h1>ATD</h1>
                    </div>
                    <div class="navbar-menu">
                        <a href="{{ url_for('main.dashboard') }}" class="navbar-item">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</a>
                        <a href="{{ url_for('tasks.list_tasks') }}" class="navbar-item">„Çø„Çπ„ÇØÁÆ°ÁêÜ</a>
                        <a href="{{ url_for('main.team_management') }}" class="navbar-item active">„ÉÅ„Éº„É†ÁÆ°ÁêÜ</a>
                        <a href="{{ url_for('main.mindmap') }}" class="navbar-item">„Éû„Ç§„É≥„Éâ„Éû„ÉÉ„Éó</a>
                        <a href="{{ url_for('main.profile') }}" class="navbar-item">„Éó„É≠„Éï„Ç£„Éº„É´</a>
                    </div>
                    <div class="user-controls">
                        <a href="{{ url_for('auth.logout') }}" class="user-control">„É≠„Ç∞„Ç¢„Ç¶„Éà</a>
                    </div>
                </div>
            </nav>

            <div class="container">
                <!-- „ÉÅ„Éº„É†„Éò„ÉÉ„ÉÄ„Éº -->
                <div class="team-header">
                    <div class="team-info">
                        <h1>{{ team.name }}</h1>
                        {% if team.description %}
                            <p class="team-description">{{ team.description }}</p>
                        {% endif %}
                    </div>
                    <div class="team-actions">
                        <a href="{{ url_for('main.team_management') }}" class="btn btn-secondary">„ÉÅ„Éº„É†ÁÆ°ÁêÜ„Å´Êàª„Çã</a>
                    </div>
                </div>

                <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Ç∞„É™„ÉÉ„Éâ -->
                <div class="dashboard-grid">
                    <!-- ‰∏äÊÆµÂ∑¶Ôºö„ÉÅ„Éº„É†„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ -->
                    <div class="card performance-card">
                        <div class="card-header">
                            <h3>„Éª„ÉÅ„Éº„É†„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</h3>
                        </div>
                        <div class="performance-stats">
                            <div class="stat-item">
                                <div class="stat-value">{{ total_tasks }}</div>
                                <div class="stat-label">‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ completed_tasks }}</div>
                                <div class="stat-label">ÂÆå‰∫Ü„Çø„Çπ„ÇØ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ "%.1f"|format(progress_percentage) }}%</div>
                                <div class="stat-label">ÂÆå‰∫ÜÁéá</div>
                            </div>
                        </div>
                    </div>

                    <!-- ‰∏äÊÆµÂè≥Ôºö‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ -->
                    <div class="card today-tasks-card">
                        <div class="card-header">
                            <h3>„Éª‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ ({{ total_tasks }}‰ª∂)</h3>
                        </div>
                        <div class="today-tasks-content">
                            {% if today_tasks %}
                                {% for task in today_tasks[:5] %}
                                    <div class="dashboard-task-item {% if task.completed %}completed{% endif %}" data-task-id="{{ task.id }}">
                                        <div class="task-checkbox">
                                            <button class="task-toggle-btn {% if task.completed %}completed{% endif %}" disabled>
                                                {% if task.completed %}‚úì{% else %}‚óã{% endif %}
                                            </button>
                                        </div>
                                        <div class="task-info">
                                            <div class="task-title">{{ task.title }}</div>
                                            <div class="task-meta">
                                                <span class="priority-badge priority-{{ task.priority }}">{{ task.priority }}</span>
                                                {% if task.assigned_to %}
                                                    <span class="assigned-to">ÊãÖÂΩì: {{ task.assigned_to }}</span>
                                                {% endif %}
                                                {% if task.due_date %}
                                                    <span class="due-date">{{ task.due_date }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% if today_tasks|length > 5 %}
                                    <div class="more-tasks">
                                        <span>‰ªñ{{ today_tasks|length - 5 }}‰ª∂„ÅÆ„Çø„Çπ„ÇØ</span>
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="no-tasks">
                                    <p>Êú¨Êó•„ÅÆ„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- ‰∏ãÊÆµÂ∑¶Ôºö„É°„É≥„Éê„ÉºÂà•ÈÄ≤Êçó -->
                    <div class="card analysis-card">
                        <div class="card-header">
                            <h3>„Éª„É°„É≥„Éê„ÉºÂà•ÈÄ≤Êçó</h3>
                        </div>
                        <div class="analysis-content">
                            {% for member in team_members %}
                                <div class="member-progress">
                                    <div class="member-info">
                                        <span class="member-name">{{ member.username }}</span>
                                        <span class="member-stats">
                                            {{ member_stats[member.id].completed }}/{{ member_stats[member.id].assigned }}
                                        </span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: {{ member_stats[member.id].completion_rate }}%"></div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- ‰∏ãÊÆµÂè≥Ôºö„ÉÅ„Éº„É†Áµ±Ë®à -->
                    <div class="card analysis-card">
                        <div class="card-header">
                            <h3>„Éª„ÉÅ„Éº„É†Áµ±Ë®à</h3>
                        </div>
                        <div class="analysis-content">
                            <div class="team-stats">
                                <div class="stat-item">
                                    <div class="stat-label">„ÉÅ„Éº„É†„É°„É≥„Éê„ÉºÊï∞</div>
                                    <div class="stat-value">{{ team_members|length }}‰∫∫</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Á∑è„Çø„Çπ„ÇØÊï∞</div>
                                    <div class="stat-value">{{ total_tasks }}‰ª∂</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">ÂÆå‰∫ÜÁéá</div>
                                    <div class="stat-value">{{ "%.1f"|format(progress_percentage) }}%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: white;
            border: 2px solid #e0e0e0;
        }

        .team-info h1 {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--text-primary);
        }

        .team-description {
            margin: 0;
            color: var(--text-secondary);
        }

        .member-progress {
            margin-bottom: var(--spacing-md);
        }

        .member-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
        }

        .member-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .member-stats {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .team-stats .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid #e0e0e0;
        }

        .team-stats .stat-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .assigned-to {
            font-size: 10px;
            color: var(--text-secondary);
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</body>
</html>
