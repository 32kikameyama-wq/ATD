<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« - ATD</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- ä¸Šéƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-brand">
    <span class="brand-title">ATD</span>
    <span class="brand-date">{{ current_date_display }}</span>
</div>
            <div class="navbar-menu">
                <a href="{{ url_for('main.dashboard') }}" class="navbar-item">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="{{ url_for('tasks.list_tasks') }}" class="navbar-item">ã‚¿ã‚¹ã‚¯ç®¡ç†</a>
                <a href="{{ url_for('main.mindmap') }}" class="navbar-item">ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—</a>
                <a href="{{ url_for('main.personal_task_cards') }}" class="navbar-item">ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰</a>
                {% if current_user.is_admin %}
                    <a href="{{ url_for('main.admin') }}" class="navbar-item">ç®¡ç†è€…</a>
                {% endif %}
                <a href="{{ url_for('main.profile') }}" class="navbar-item active">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
            </div>
            <div class="user-controls">
                <a href="{{ url_for('main.notifications') }}" class="btn btn-sm" style="position: relative; margin-right: 5px;">
                    ğŸ””
                    {% if unread_notifications > 0 %}
                        <span style="position: absolute; top: -5px; right: -5px; background: #f44336; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">{{ unread_notifications }}</span>
                    {% endif %}
                </a>
                <a href="{{ url_for('auth.logout') }}" class="btn btn-sm btn-outline">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
                <a href="#" class="user-control active personal-mode">
                    å€‹äºº
                </a>
                <a href="#" class="user-control">
                    ãƒãƒ¼ãƒ 
                </a>
                <a href="{{ url_for('main.profile') }}" class="user-control">
                    {% if current_user.display_name %}{{ current_user.display_name }}{% else %}{{ current_user.username }}{% endif %}
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†</h1>
        </div>

        <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="dashboard-grid">
                <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† -->
                <div class="card profile-form-card">
                    <div class="card-header">
                        <h3>ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h3>
                    </div>
                    <form class="profile-form" method="POST">
                        <div class="form-group">
                            <label for="display_name">è¡¨ç¤ºå</label>
                            <input type="text" id="display_name" name="display_name" class="form-control" value="{% if current_user.display_name %}{{ current_user.display_name }}{% endif %}" placeholder="è¡¨ç¤ºã—ãŸã„åå‰ã‚’å…¥åŠ›">
                        </div>
                        
                        <div class="form-group">
                            <label for="bio">è‡ªå·±ç´¹ä»‹</label>
                            <textarea id="bio" name="bio" class="form-control" rows="4" placeholder="è‡ªå·±ç´¹ä»‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">{% if current_user.bio %}{{ current_user.bio }}{% endif %}</textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                            <button type="reset" class="btn btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
                        </div>
                    </form>
                </div>

                <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ± -->
                <div class="card profile-info-card">
                    <div class="card-header">
                        <h3>ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h3>
                    </div>
                    <div class="profile-info">
                        <div class="profile-details">
                            <h4>{% if current_user.display_name %}{{ current_user.display_name }}{% else %}{{ current_user.username }}{% endif %}</h4>
                            <p>{{ current_user.username }}</p>
                            <p>{{ current_user.email }}</p>
                            {% if current_user.bio %}
                                <p style="margin-top: 1rem; color: #666;">{{ current_user.bio }}</p>
                            {% endif %}
                            <p class="join-date">ç™»éŒ²æ—¥: {{ current_user.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥') }}</p>
                        </div>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-value">{{ completed_count }}</div>
                            <div class="stat-label">å®Œäº†ã‚¿ã‚¹ã‚¯</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ in_progress_count }}</div>
                            <div class="stat-label">é€²è¡Œä¸­</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ completion_rate }}%</div>
                            <div class="stat-label">å®Œäº†ç‡</div>
                        </div>
                    </div>
                </div>
        </div>
    </div>

    <script>
        // å€‹äºº/ãƒãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.user-control').forEach(control => {
            control.addEventListener('click', function(e) {
                if (this.textContent.trim() === 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«' || this.textContent.trim() === '{% if current_user.display_name %}{{ current_user.display_name }}{% else %}{{ current_user.username }}{% endif %}') {
                    return; // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã¯ãã®ã¾ã¾é·ç§»
                }
                e.preventDefault();
                document.querySelectorAll('.user-control').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                
                const mode = this.textContent.trim();
                if (mode === 'ãƒãƒ¼ãƒ ') {
                    window.location.href = '/team-management';
                }
            });
        });
    </script>
</body>
</html>
